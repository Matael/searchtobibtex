#!/bin/bash
# Ati Sharma 2015
# performs crossref search and uses DOI to pull bibtex
# see e.g. http://labs.crossref.org/resolving-citations-we-dont-need-no-stinkin-parser/

# parse command line args
USERNAME=a.sharma@soton.ac.uk
PASSWORD=
AUTHOR=$1
TITLE=
JOURNAL=$2
ISSN=
VOLUME=
ISSUE=
YEAR=$3

# bibtool key format string
BIBKEYFMT='%3n(author)%+4d($year)'
# All the things that you don't want in your bibtex entry, separated by \|
BIBENTRYFILTER='= ,\|\"-\"\|url'

# construct the freeform search
QUERYURL="https://www.crossref.org/openurl?pid=$USERNAME:$PASSWORD&aulast=$AUTHOR&title=$JOURNAL&date=$YEAR&noredirect=true


# extract the DOI and the score
curl -s "$QUERYURL"

exit

# turn DOI into URL
DOI=$(echo $1 | sed 's/.*doi.org\///')
URL="http://dx.doi.org/$DOI"

#echo "@COMMENT {Generated by doi2bibtex from $URL on $(date)}"

# use crossref API
# see http://www.crossref.org/CrossTech/2011/11/turning_dois_into_formatted_ci.html
# resolve URL
curl -s -LH "Accept: text/bibliography; style=bibtex" $URL | sed 's/,/,\n/g' | sed 's/}}/}\n}/' | grep -v "$BIBENTRYFILTER" | bibclean -delete-empty-values -no-check-values | bibtool -F -f "$BIBKEYFMT";

